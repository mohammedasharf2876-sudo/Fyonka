export default async function handler(req, res) {
  function send(status, obj) {
    res.statusCode = status;
    res.setHeader("Content-Type", "application/json; charset=utf-8");
    res.setHeader("Cache-Control", "no-store");
    res.end(JSON.stringify(obj));
  }

  if (req.method === "GET") {
    return send(200, { ok: true, route: "/api/chat", mode: "NO-KEY-FYONKA-V2" });
  }

  if (req.method !== "POST") {
    return send(405, { reply: "Method not allowed" });
  }

  const body = await new Promise((resolve) => {
    try {
      if (req.body && typeof req.body === "object") return resolve(req.body);
      let raw = "";
      req.on("data", (c) => (raw += c));
      req.on("end", () => {
        if (!raw) return resolve({});
        try { resolve(JSON.parse(raw)); } catch { resolve({}); }
      });
    } catch {
      resolve({});
    }
  });

  const message = String(body.message || "").trim();
  const hintType = String(body.type || "ุนุงูุฉ");

  if (!message) return send(200, { reply: "ูููู ุณุคุงูู ูุง ููุฑ ๐" });

  const m = message.toLowerCase();

  // ูููุงุช ููุชุงุญูุฉ
  const skincareKeys = ["ุจุดุฑุฉ","ุณููู","ุฑูุชูู","ุบุณูู","cleanser","ูุฑุทุจ","moistur","ูุงูู","spf","sunscreen","ุณูุฑู","serum","ููุชุงููู c","vitamin c","ููุงุณููุงููุฏ","niacin","ููุงููุฑูููู","hyal","ุฑูุชูููู","retinol","ุชูุดูุฑ","aha","bha","ุณุงููุณูููู","salicy","ุฌููููููู","glyco","ุญุณุงุณูุฉ","ุชููุฌ","ุงุญูุฑุงุฑ","ุญูุฉ","ุญุจูุจ","acne","ุชุตุจุบุงุช","ุจูุน","ููู","melasma","ูุณุงู","pores","ุฌูุงู","dry","ุฏููู","oily"];
  const makeupKeys   = ["ูููุงุจ","makeup","ูุงููุฏูุดู","foundation","ูููุณููุฑ","concealer","ุจูุฏุฑุฉ","powder","ุจุฑุงููุฑ","primer","ุจูุงุดุฑ","blush","ุจุฑููุฒุฑ","bronzer","ูุงููุงูุชุฑ","highlighter","ุงูุดุงุฏู","ุขูุดุงุฏู","eyeshadow","ุงููุงููุฑ","ุขููุงููุฑ","liner","ูุงุณูุงุฑุง","mascara","ุฑูุฌ","lipstick","ููุจ","lip","ุชููุช","tint","ุญูุงุฌุจ","brows","ุชุซุจูุช","setting","ุณุจุฑุงู","spray"];
  const accKeys      = ["ุฎุงุชู","ring","ุณูุณูุฉ","ุณูุณูู","chain","ููููู","necklace","ุทูู","set","ุญูู","earring","ูุฑุท","ุงูุณูุงู","bracelet","ุงุณูุฑุฉ","ุฃุณูุฑุฉ","ุณูุงุฑ","ุบูุงูุด","bangles","ุฎูุฎุงู","anklet","ุชููุฉ","ุชููู","hair","ุฏุจูุณ","pin","ุจุฑูุด","brooch","ุชุนูููุฉ","charms","ุดูุทุฉ","bag","ุณุชุงููุณ","stainless","ูุถุฉ","ูุถู","silver","ูุทูู","plated","ุฐูุจ","ุฏูุจ","gold","ุงูุณุณูุงุฑ","ุฅูุณุณูุงุฑ"];

  function hasAny(keys) {
    for (let i = 0; i < keys.length; i++) if (m.indexOf(keys[i]) !== -1) return true;
    return false;
  }

  function opener() {
    const arr = [
      "ูุง ููุง ูุง ููุฑ ๐",
      "ุชูุงู ูุง ุฌูููุฉ ๐",
      "ุญุงุถุฑ ูุง ุญุจูู โจ",
      "ููุฑุชู ูููููุฉ ูุง ุณูุฑ ๐"
    ];
    return arr[Math.floor(Math.random() * arr.length)];
  }

  function wrap(title, bullets, ask, note) {
    let out = [];
    out.push(opener());
    out.push("**" + title + "**");
    out.push("");

    for (let i = 0; i < bullets.length; i++) out.push("โ " + bullets[i]);

    if (note) {
      out.push("");
      out.push("โ๏ธ " + note);
    }
    if (ask) {
      out.push("");
      out.push("ุณุคุงู ุตุบูุฑ ูุง ููุฑ: " + ask);
    }
    return out.join("\n");
  }

  // ===== ูููู/ูุณุงุนุฏุฉ =====
  const helpKeys = ["ูููู","menu","help","ูุณุงุนุฏุฉ","ุงุฎุชูุงุฑุงุช","ุจุชุนููู ุงูู","ุจุชุณุงุนุฏู ูู ุงูู","ุงุจุฏุฃ ุงุฒุงู","ุงุจุฏุฃ"];
  const hiKeys = ["hi","hello","ุงููุง","ุฃููุง","ุงูุณูุงู","ูุงู","ุงุฒูู","ุฅุฒูู","ุนุงูู ุงูู","ุนุงููุฉ ุงูู"];

  function menuReply() {
    return wrap(
      "ุงุฎุชุงุฑู ุงููุณู ุงููู ุงูุชู ุนุงูุฒุงู ๐",
      [
        "**ุฅูุณุณูุงุฑุงุช**: ุงุฎุชูุงุฑ ุงููุทุนุฉ + ุณุชุงูู + ุฎุงูุงุช + ููุงุณุงุช + ุนูุงูุฉ ูุชุฎุฒูู",
        "**ูููุงุจ**: ุฏุฑุฌุงุช + ุงูุฏุฑุชูู + ูููุงุช (ูููู/ุณูุฑุฉ) + ูุดุงูู (ูููู/ุฃูุณุฏุฉ/ููุนุงู)",
        "**ุณููู ููุฑ**: ุฑูุชูู ุตุจุงุญ/ููู + ุญุจูุจ/ุชุตุจุบุงุช/ูุณุงู/ุฌูุงู/ุญุณุงุณูุฉ + ุฏูุฌ ุตุญ"
      ],
      "ุงูุชุจู ูุซูุงู: (ุนุงูุฒุฉ ุฎุงุชู ูุฏูุฉ) ุฃู (ูุงููุฏูุดู ูุจุดุฑุฉ ุฏูููุฉ) ุฃู (ุฑูุชูู ููุชุตุจุบุงุช)",
      ""
    );
  }

  if (hasAny(helpKeys) || hasAny(hiKeys)) {
    return send(200, { reply: menuReply() });
  }

  // ===== ุฃุณุฆูุฉ ุนุงูุฉ ููููุฉ (ุณุนุฑ/ุชูุตูู/ูุฏูุฉ/ููุงุณ) =====
  if (hasAny(["ุณุนุฑ","ุจูุงู","ูุงู","price","ุงูุซูู","ุจูู"])) {
    return send(200, {
      reply: wrap(
        "ุงูุฃุณุนุงุฑ ๐ธ",
        [
          "ุงูุฃุณุนุงุฑ ุจุชุฎุชูู ุญุณุจ (ุงูุฎุงูุฉ + ุงูููุฏูู + ุชูุงุตูู ุงููุทุนุฉ).",
          "ูููููู ุงูุชู ุจุชุฏูุฑู ุนูู **ุฅูุณุณูุงุฑ** ููุง **ูููุงุจ** ููุง **ุณููู ููุฑ** ูุฃูุง ุฃุธุจุทูู ุงูุชุฑุงุญุงุช ุชูุงุณุจ ููุฒุงููุชู.",
          "ูู ูุฏูุฉโฆ ูููููู ุณูููุง/ุณุชุงูููุง (ูุงุนู ููุง ุฌุฑูุก) ูุงูุง ุฃุฎุชุงุฑูู ุญุงุฌุฉ ุชููู ๐"
        ],
        "ููุฒุงููุชู ุชูุฑูุจูุง ูุงูุ",
        ""
      )
    });
  }

  if (hasAny(["ุชูุตูู","ุดุญู","ุฏูููุฑู","delivery","shipping"])) {
    return send(200, {
      reply: wrap(
        "ุงูุชูุตูู ๐",
        [
          "ูููููู **ูุญุงูุธุชู/ููุทูุชู** ูุฃูุง ุฃูููู ุงููุฏุฉ ูุงูุชูููุฉ ุงููุชุงุญุฉ.",
          "ูู ุงูุทูุจ ูุฏูุฉโฆ ุชุญุจู **ุชุบููู** ููุง ูุงุฑุช ุตุบูุฑุ ๐"
        ],
        "ูุญุงูุธุชู ุฅููุ",
        ""
      )
    });
  }

  if (hasAny(["ููุงุณ","ููุงุณ","ูุงุณุน","ุถูู","size"])) {
    return send(200, {
      reply: wrap(
        "ุงูููุงุณุงุช ๐",
        [
          "ุงูุฎุงุชู: ุงูุฃูุถู ุชููุณู ูุญูุท ุงูุฅุตุจุน ุฃู ุฎุงุชู ูุฏูู ุจููุณ ุงูุฅุตุจุน.",
          "ุงูุฃุณูุฑุฉ/ุงูุงูุณูุงู: ููุณู ูุญูุท ุงููุนุตู ูุณูุจู 1 ุณู ุฑุงุญุฉ.",
          "ูู ูุฏูุฉ ููุด ุนุงุฑูุฉ ุงูููุงุณ: ุงุฎุชุงุฑู **ููุงุณ ูุชูุณุท** ุฃู ููุฏูู ูุงุจู ููุชุนุฏูู."
        ],
        "ุงููุทุนุฉ ุฅูู ุจุงูุธุจุทุ (ุฎุงุชู/ุฃุณูุฑุฉ/ุณูุณูุฉ)ุ",
        ""
      )
    });
  }

  // ===== Accessories =====
  function accessoryType() {
    if (m.indexOf("ุฎุงุชู") !== -1 || m.indexOf("ring") !== -1) return "ุฎุงุชู";
    if (m.indexOf("ุทูู") !== -1 || m.indexOf("set") !== -1) return "ุทูู/ุณููุช";
    if (m.indexOf("ุณูุณูุฉ") !== -1 || m.indexOf("ุณูุณูู") !== -1 || m.indexOf("ููููู") !== -1 || m.indexOf("necklace") !== -1) return "ุณูุณูุฉ/ููููู";
    if (m.indexOf("ุงูุณูุงู") !== -1 || m.indexOf("ุงุณูุฑุฉ") !== -1 || m.indexOf("ุฃุณูุฑุฉ") !== -1 || m.indexOf("bracelet") !== -1 || m.indexOf("ุณูุงุฑ") !== -1) return "ุฃุณูุฑุฉ/ุงูุณูุงู";
    if (m.indexOf("ุบูุงูุด") !== -1 || m.indexOf("ุบููุดุฉ") !== -1 || m.indexOf("bangles") !== -1) return "ุบูุงูุด";
    if (m.indexOf("ุญูู") !== -1 || m.indexOf("ูุฑุท") !== -1 || m.indexOf("earring") !== -1) return "ุญูู";
    if (m.indexOf("ุฎูุฎุงู") !== -1 || m.indexOf("anklet") !== -1) return "ุฎูุฎุงู";
    if (m.indexOf("ุชููุฉ") !== -1 || m.indexOf("ุชููู") !== -1 || m.indexOf("hair") !== -1 || m.indexOf("ุฏุจูุณ") !== -1 || m.indexOf("pin") !== -1) return "ุชูู/ุฏุจุงุจูุณ";
    if (m.indexOf("ุจุฑูุด") !== -1 || m.indexOf("brooch") !== -1) return "ุจุฑูุด";
    if (m.indexOf("ุชุนูููุฉ") !== -1 || m.indexOf("ุดูุทุฉ") !== -1 || m.indexOf("bag") !== -1 || m.indexOf("charms") !== -1) return "ุชุนูููุฉ ุดูุทุฉ/Charm";
    return hintType || "ุฅูุณุณูุงุฑุงุช ุนุงูุฉ";
  }

  function materialHint() {
    if (m.indexOf("ุณุชุงููุณ") !== -1 || m.indexOf("stainless") !== -1) return "ุณุชุงููุณ";
    if (m.indexOf("ูุถุฉ") !== -1 || m.indexOf("ูุถู") !== -1 || m.indexOf("silver") !== -1) return "ูุถุฉ";
    if (m.indexOf("ูุทูู") !== -1 || m.indexOf("plated") !== -1) return "ูุทูู";
    if (m.indexOf("ุฐูุจ") !== -1 || m.indexOf("ุฏูุจ") !== -1 || m.indexOf("gold") !== -1) return "ุฐูุจ";
    return "";
  }

  const ACC = {
    "ุฎุงุชู": [
      "ุดูููู ููุช ุงูููุฉ ูุงูุตุงุจูู ูุงูููุธูุงุชโฆ ุฏู ุฃุณุฑุน ุญุงุฌุฉ ุชุจูุช ุงูููู.",
      "ูู ููู ูุตูุต: ุจูุงุด ูุฑู ุฌุงูุฏโฆ ุงูุณุญู ุจูุทูุฉ ูุงุดูุฉ ูุฎูุงุต.",
      "ุฎุฒููู ููุญุฏู ุนุดุงู ููุฎุฑุจุด ููุง ูุชุฎุฏุด ูุน ูุทุน ุชุงููุฉ.",
      "ูู ูุฏูุฉ: ุงุฎุชุงุฑู ููุฏูู โAdjustableโ ูู ูุด ุนุงุฑูุฉ ุงูููุงุณ."
    ],
    "ุณูุณูุฉ/ููููู": [
      "ุจูุงุด ููู ุจููุง ุนุดุงู ูุชุชุนูุฏุด.",
      "ุงูุจุฑูุงู/ุงูุณุจุฑุงู ูุงุฒู ููุดู ุงูุฃูู ูุจุนุฏูู ุชูุจุณููุง.",
      "ูู ุงุชุนูุฏุช: ุงูุฑุฏููุง ุนูู ุณุทุญ ูุงุนู ูุญุฑููู ุงูุนูุฏุฉ ุจุฏุจูุณ ุจูุฏูุก.",
      "ุฎุฒูููุง ูุชูุฑุฏุฉ ุฃู ูุชุนููุฉ ุนุดุงู ูุชุชูููุด."
    ],
    "ุทูู/ุณููุช": [
      "ุงูุทูู ุจูุทูุน ุดูู ุฌุฏูุง ูู ุญุงูุธุชู ุนูู ุชูุงุณู ุงูููู (ุฏูุจู/ูุถู).",
      "ุงูุจุณูู ุนูู ูุจุณ ุจุณูุท ุนุดุงู ูุจุงู ูู ุงููู ุนุงูู ุงูุดูุงูุฉ.",
      "ุฎุฒููู ูู ุนูุจุฉ ูุงุญุฏุฉ ููุณูุฉ ุนุดุงู ุงููุทุน ูุชุฎุจุทุด ูู ุจุนุถ."
    ],
    "ุฃุณูุฑุฉ/ุงูุณูุงู": [
      "ุดูููู ููุช ุงูุดุงูุฑ ูุงูุจุญุฑ ูุงููููุฑ.",
      "ุงูุงูุณูุงู ุงูุฑููู ุจูุงุด ุดุฏ ุฌุงูุฏ ุนููู ุนุดุงู ููุชููุด.",
      "ุงูุณุญูู ุจุนุฏ ุงููุจุณ ุจูุทูุฉ ูุงุดูุฉ (ุฎุตูุตูุง ูู ูู ุนุฑู).",
      "ูู ุจุชุชุญุณุณู: ุงูุณุชูุงููุณ/ูุถุฉ ุบุงูุจูุง ุฃุญุณู."
    ],
    "ุบูุงูุด": [
      "ุงุจุนุฏููุง ุนู ุงูุฎุจุทุงุช ุนุดุงู ูุชุชุฌุฑุญุด.",
      "ูููุนู ุจูุทูุฉ ูุงุดูุฉ ุฃู ููุงุดุฉ ูุงุนูุฉ.",
      "ูุชุชุฎุฒููุด ููู ูุจูููุฉโฆ ุงูุฑุทูุจุฉ ุจุชุจูุธ ุงูููู."
    ],
    "ุญูู": [
      "ูู ูุฏูู ุจุชุชุญุณุณ: ุงุฎุชุงุฑู ุณุชุงููุณ/ูุถุฉ ูุงูุชูู ุจูุธุงูุฉ ุงููุฏู ูุจู ุงููุจุณ.",
      "ูุชูุงููุด ุจูู ูู ุทููู/ูุฏููู ุนุดุงู ููุถุบุทุด.",
      "ุจูุงุด ุนุทุฑ ูุจุงุดุฑ ุนูู ุงูุญูู."
    ],
    "ุฎูุฎุงู": [
      "ุงูุฎูุฎุงู ุจูุชุนุฑุถ ููุฑุทูุจุฉ ุฃูุชุฑโฆ ุงุจุนุฏูู ุนู ุงูููุฉ ูุงููููุฑ.",
      "ุฎุฒููู ููุญุฏู ุนุดุงู ููุนููุด ุฎุฏูุด.",
      "ุงูุณุญูู ูุงุดู ุจุนุฏ ุงููุจุณ."
    ],
    "ุชูู/ุฏุจุงุจูุณ": [
      "ุฎูููู ุจุนูุฏ ุนู ุงูููุฉ ุนุดุงู ุงููุนุฏู ููุณููุณุด.",
      "ูู ูููู ุณุชุฑุงุณุงุช/ููุงุด: ุชูุถูู ูุงุดู ุจูุฑุดุฉ ูุงุนูุฉ.",
      "ุฎุฒูููู ูู ุนูุจุฉ ููุณูุฉ ุนุดุงู ููุชูุณุฑุด ุงูุดูู."
    ],
    "ุจุฑูุด": [
      "ุฑููุจูู ูู ููุงู ุซุงุจุช ูู ุงููุฏูู (ูุงูุฉ/ูุชู) ุนุดุงู ููุชุญุฑูุด ูุชูุฑ.",
      "ุจูุงุด ูุชุนุฑุถ ูุนุทุฑ ูุจุงุดุฑ.",
      "ุฎุฒููู ูู ุนูุจุฉ ุตุบูุฑุฉ ููุญุฏู."
    ],
    "ุชุนูููุฉ ุดูุทุฉ/Charm": [
      "ุงุชุฃูุฏู ุฅููุง ูุชุซุจุชุฉ ูููุณ ุนุดุงู ูุชูุนุด.",
      "ุจูุงุด ุชุฎุจุท ูุชูุฑ ูู ุงูููุงุชูุญ ุนุดุงู ูุชุชุฎุฏุด.",
      "ุงูุณุญููุง ูุงุดู ูู ููุช ููุชุงูู ุนุดุงู ุชูุถู ูุงูุนุฉ."
    ],
    "ุฅูุณุณูุงุฑุงุช ุนุงูุฉ": [
      "ูุงุนุฏุฉ ูููููุฉ: ููุฉ + ุนุทุฑ + ูุญูู = ุจูุชุงู ุฃุณุฑุน ๐",
      "ุฎุฒููู ูู ูุทุนุฉ ููุญุฏูุง ูุงูุณุญููุง ูุงุดู ุจุนุฏ ุงููุจุณ.",
      "ูู ุงูููู ุจูุบูู ุจุณุฑุนุฉ: ุบุงูุจูุง ูู ุนุฑู/ุนุทุฑโฆ ุฎูููู ุจุนูุฏ."
    ]
  };

  function accessoriesReply() {
    const t = accessoryType();
    const mat = materialHint();
    let title = "ุฅูุณุณูุงุฑุงุช โ " + t;
    if (mat) title += " (" + mat + ")";

    let bullets = (ACC[t] || ACC["ุฅูุณุณูุงุฑุงุช ุนุงูุฉ"]).slice(0, 6);

    // ุฅุถุงูุงุช ุจุณูุทุฉ ุญุณุจ ุงูุฎุงูุฉ (ูู ุบูุฑ ุชุนููุฏ)
    if (mat === "ูุทูู") bullets.push("ุจุงููุฎุชุตุฑ ูู ูุทูู: ุฎูููุง ุจุนูุฏ ุนู ุงูููุฉ 100% ุนุดุงู ุงูููู ููุจูุชุด.");
    if (mat === "ูุถุฉ") bullets.push("ุงููุถุฉ ูููู ุชุณููุฏ ุทุจูุนูโฆ ุชูููุน ุจููุงุดุฉ ูุถุฉ ูุฑุฌุนูุง ุฒู ุงููู.");

    return wrap(
      title,
      bullets.slice(0, 7),
      "ุชุญุจููุง ุณุชุงูู ูุงุนู ููุง ุฌุฑูุกุ ูุจุชููู ูููุงุณุจุฉ ุฅููุ",
      ""
    );
  }

  // ===== Makeup =====
  function makeupFocus() {
    if (m.indexOf("ูุงููุฏูุดู") !== -1 || m.indexOf("foundation") !== -1) return "ูุงููุฏูุดู";
    if (m.indexOf("ูููุณููุฑ") !== -1 || m.indexOf("concealer") !== -1) return "ูููุณููุฑ";
    if (m.indexOf("ุจูุฏุฑุฉ") !== -1 || m.indexOf("powder") !== -1) return "ุจูุฏุฑุฉ";
    if (m.indexOf("ุจุฑุงููุฑ") !== -1 || m.indexOf("primer") !== -1) return "ุจุฑุงููุฑ";
    if (m.indexOf("ุจูุงุดุฑ") !== -1 || m.indexOf("blush") !== -1) return "ุจูุงุดุฑ";
    if (m.indexOf("ุจุฑููุฒุฑ") !== -1 || m.indexOf("bronzer") !== -1) return "ุจุฑููุฒุฑ";
    if (m.indexOf("ูุงููุงูุชุฑ") !== -1 || m.indexOf("highlighter") !== -1) return "ูุงููุงูุชุฑ";
    if (m.indexOf("ุฑูุฌ") !== -1 || m.indexOf("lipstick") !== -1 || m.indexOf("ููุจ") !== -1 || m.indexOf("tint") !== -1) return "ุดูุงูู";
    if (m.indexOf("ูุงุณูุงุฑุง") !== -1 || m.indexOf("mascara") !== -1) return "ูุงุณูุงุฑุง";
    if (m.indexOf("ุญูุงุฌุจ") !== -1 || m.indexOf("brows") !== -1) return "ุญูุงุฌุจ";
    if (m.indexOf("ุงููุงููุฑ") !== -1 || m.indexOf("ุขููุงููุฑ") !== -1 || m.indexOf("liner") !== -1) return "ุขููุงููุฑ";
    if (m.indexOf("ุงูุดุงุฏู") !== -1 || m.indexOf("ุขูุดุงุฏู") !== -1 || m.indexOf("eyeshadow") !== -1) return "ุนููู";
    if (m.indexOf("setting") !== -1 || m.indexOf("ุณุชูุฌ") !== -1 || m.indexOf("spray") !== -1 || m.indexOf("ุณุจุฑุงู") !== -1) return "ุชุซุจูุช";
    return "ูููุงุจ ุนุงู";
  }

  const MK = {
    "ูุงููุฏูุดู": [
      "ูู ุจุดุฑุชู ุฏูููุฉ: ูุงุช/ุณููุช ูุงุช + ุจูุฏุฑุฉ ุนูู ุงููT-zone ุจุณ.",
      "ูู ุฌุงูุฉ: ุชุฑุทูุจ ููู + ูุงููุฏูุดู ูุฑุทุจ/ุฌูู.",
      "ูู ุจูุฃูุณุฏ (ูุณููุฏ): ุญุทู ุทุจูุงุช ุฎูููุฉ ูุงุณุชูู ุฏูููุชูู ูุจู ูุง ุชุฒูุฏู.",
      "ุงุฎุชุจุงุฑ ุงูุฏุฑุฌุฉ: ุนูู ุฎุท ุงููู ูู ุถูุก ุงูููุงุฑ (ูุด ุนูู ุงูุฅูุฏ).",
      "ูููู ุญูู: ุณุจููุฌ ูุจูููุฉ ุฎููู ุชุฏู ูููููุด ุฃูุนู."
    ],
    "ูููุณููุฑ": [
      "ุชุญุช ุงูุนูู: ุฃูุชุญ ุจูุต ุฏุฑุฌุฉ ูููุงู ุฎููู ุนุดุงู ููููุฑูุด.",
      "ููุชุตุจุบุงุช/ุงูุญุจูุจ: ููุณ ุฏุฑุฌุฉ ุจุดุฑุชู ูููุงู ุฃุณูู ุดููุฉ.",
      "ุซุจุชูู ุจุจูุฏุฑุฉ ุจุณูุทุฉ ุฌุฏูุง (ูุด ูุชูุฑ).",
      "ูู ุจููุฑูุจ: ูููู ูููุฉ ุงูููุชุฌ ูุฒูุฏู ุชุฑุทูุจ ุชุญุช ุงูุนูู."
    ],
    "ุจูุฏุฑุฉ": [
      "ุงูุฏูููุฉ: ุจูุฏุฑุฉ ุดูุงูุฉ ุฎูููุฉ ุนูู ุงููT-zone.",
      "ุงูุฌุงูุฉ: ููุณุฉ ุฎูููุฉ ุฌุฏูุงโฆ ุฃู ุจูุงุด ูู ุจุชุฏู ุดูู ูููู.",
      "ูู ูููู: ูููู ุจูุฏุฑุฉ + ุฒูุฏู ุชุฑุทูุจ + ุณุจุฑุงู ุชุซุจูุช ุฎููู."
    ],
    "ุจุฑุงููุฑ": [
      "ูุณุงู: ุจุฑุงููุฑ blur ุนูู ุงูููุงุทู ุฏู ุจุณ.",
      "ููุนุงู: ุจุฑุงููุฑ ูุงุช ูููT-zone.",
      "ุฌูุงู: ุจุฑุงููุฑ ูุฑุทุจ ูุจู ุฃู ุญุงุฌุฉ."
    ],
    "ุจูุงุดุฑ": [
      "ูููู: ุฑูุฒ/ุจูุชุด ุฎูููโฆ ูุฏู ุดูู ุตุญู ูุดูู.",
      "ุณูุฑุฉ: ุฒูุฏู ุจุงูุชุฏุฑูุฌ ุนุดุงู ููุถู ุทุจูุนู.",
      "ุงูุฏูููุฉ: ุงูุจูุงุดุฑ ุงูุจูุฏุฑ ุจูุซุจุช ุฃูุชุฑ."
    ],
    "ุจุฑููุฒุฑ": [
      "ุญุทูู ุชุญุช ุนุธูุฉ ุงูุฎุฏ ุจุดูู ุฎูููโฆ ูุงุฏูุฌู ูููุณ.",
      "ุงุฎุชุงุฑู ุฏุฑุฌุฉ ุฏุงููุฉ ุจุณูุทุฉ ูุด ุบุงููุฉ ููู ุนุดุงู ููุจุงูุด ุจูุน."
    ],
    "ูุงููุงูุชุฑ": [
      "ุญุทูู ุนูู ุฃุนูู ุงูุฎุฏ/ุทุฑู ุงูุฃูู ููุณุฉ ุจุณูุทุฉ.",
      "ูู ูุณุงูู ูุงุณุนุฉ: ุจูุงุด ุชุญุทูู ูุฑูุจ ููู ูู ููุทูุฉ ุงููุณุงู."
    ],
    "ุดูุงูู": [
      "ุซุจุงุช: ูุงููุฑ + ุฑูุฌ ูุงุช + ุชุฑุจูุช ุจููุฏูู + ุทุจูุฉ ุฎูููุฉ ุชุงููุฉ.",
      "ุฑุงุญุฉ: ุฑูุฌ ูุฑููู/ุชููุช ูุน ุชุฑุทูุจ ูุจููุง.",
      "ุงุฎุชูุงุฑ ุงูููู: ุฏุงูู (ููุฑุงู/ุจูุชุด) โ ุจุงุฑุฏ (ุฑูุฒ/ููู)."
    ],
    "ูุงุณูุงุฑุง": [
      "ูู ุจุชุณููุญ: Waterproof ุฃู ููุงููุฉ ููููุฉ.",
      "ูุชูุชููุด: ุงูุณุญู ุงูุฒูุงุฏุฉ ูู ุงููุฑุดุฉ ุงูุฃูู.",
      "ููุฑูุฑ ูุจููุง ููุฑู ุฌุฏูุง ูู ุงูุดูู."
    ],
    "ุญูุงุฌุจ": [
      "ุงูููู ุงููุฑุงุบุงุช ุจุฎูุฉโฆ ูุงูุดุทู ุจูุฑุดุฉ ุนุดุงู ูุทูุน ุทุจูุนู.",
      "ูู ุนุงูุฒุฉ ุซุจุงุช: ุฌู ุญูุงุฌุจ ูู ุงูุขุฎุฑ."
    ],
    "ุขููุงููุฑ": [
      "ูููู: ุฎุท ุฑููุน ูุฑูุจ ูู ุงูุฑููุด.",
      "ุณูุฑุฉ: wing ุจุณูุท ุญุณุจ ุดูู ุนููู.",
      "ูู ุจูุณููุญ: ุงุฎุชุงุฑู ููุงูู ููููุฉ."
    ],
    "ุนููู": [
      "ููุงุฑ: ุจูู/ุจูุฌ + ููุนุฉ ุจุณูุทุฉ.",
      "ููู: ุณูููู ุฎููู + ูุงููุฑ.",
      "ุจุฑุงููุฑ ุนูู ูููุน ุงูุชูุชู ูุงูุชุฌููุน."
    ],
    "ุชุซุจูุช": [
      "ูู ุฏูููุฉ: ุณุจุฑุงู ูุงุช ุจุนุฏ ุงููููุงุจ.",
      "ูู ุฌุงูุฉ: ุณุจุฑุงู ูุฑุทุจ.",
      "ุฑุดูุงุช ุฎูููุฉโฆ ูุด ุฑุด ูุชูุฑ ูุฑุฉ ูุงุญุฏุฉ."
    ],
    "ูููุงุจ ุนุงู": [
      "ูููููู ุงูููุงุณุจุฉ (ุตุจุงุญ/ุฌุงูุนุฉ/ุดุบู/ุณูุฑุฉ) ูุฃูุง ุฃุนููู ููู ูุงูู ุฎุทูุฉ ุจุฎุทูุฉ.",
      "ูู ุนูุฏู ูุดููุฉ (ููุนุงู/ูููู/ุฃูุณุฏุฉ) ูููููู ุจุชุญุตู ููู ูููุญููุง."
    ]
  };

  function makeupReply() {
    const f = makeupFocus();
    return wrap(
      "ูููุงุจ โ " + f,
      (MK[f] || MK["ูููุงุจ ุนุงู"]).slice(0, 7),
      "ููุน ุจุดุฑุชู ุฅููุ ูุนุงูุฒุฉ ููู ูููู ููุง ุณูุฑุฉุ",
      ""
    );
  }

  // ===== Skincare =====
  function skinType() {
    if (m.indexOf("ุฏูููุฉ") !== -1 || m.indexOf("ุฏูููู") !== -1 || m.indexOf("oily") !== -1) return "ุฏูููุฉ";
    if (m.indexOf("ุฌุงูุฉ") !== -1 || m.indexOf("ุฌุงูู") !== -1 || m.indexOf("ูุงุดูุฉ") !== -1 || m.indexOf("dry") !== -1) return "ุฌุงูุฉ";
    if (m.indexOf("ูุฎุชูุทุฉ") !== -1 || m.indexOf("ูุฎูุทุฉ") !== -1) return "ูุฎุชูุทุฉ";
    if (m.indexOf("ุญุณุงุณุฉ") !== -1 || m.indexOf("ุญุณุงุณู") !== -1 || m.indexOf("sensitive") !== -1) return "ุญุณุงุณุฉ";
    return "";
  }

  function concern() {
    if (m.indexOf("ุญุจูุจ") !== -1 || m.indexOf("acne") !== -1) return "ุญุจูุจ";
    if (m.indexOf("ุชุตุจุบุงุช") !== -1 || m.indexOf("ุจูุน") !== -1 || m.indexOf("ููู") !== -1) return "ุชุตุจุบุงุช";
    if (m.indexOf("ูุณุงู") !== -1 || m.indexOf("pores") !== -1) return "ูุณุงู";
    if (m.indexOf("ุฌูุงู") !== -1 || m.indexOf("ุชูุดูุฑ") !== -1) return "ุฌูุงู";
    if (m.indexOf("ุญุณุงุณูุฉ") !== -1 || m.indexOf("ุชููุฌ") !== -1 || m.indexOf("ุงุญูุฑุงุฑ") !== -1 || m.indexOf("ุญูุฉ") !== -1) return "ุญุณุงุณูุฉ";
    return "";
  }

  function skincareReply() {
    const st = skinType();
    const co = concern();

    let bullets = [];
    bullets.push(st ? ("ูููุดู ุนูู ุฑูุชูู ุจุณูุท ููุงุณุจ ูู **" + st + "** ุนุดุงู ูุชุชููููุด.") : "ูููุดู ุนูู ุฑูุชูู ุจุณูุทโฆ ุนุดุงู ูุฌูุจ ูุชูุฌุฉ ูู ุบูุฑ ุฒุญูุฉ ููุชุฌุงุช.");

    if (co === "ุญุจูุจ") bullets.push("ููุญูุจูุจ: ุบุณูู ูุทูู + ุณุงููุณูููู ุฎููู (ูู ููุงุณุจ) + ูุฑุทุจ + SPFโฆ ูุงูุฃูู ุงูุงุณุชูุฑุงุฑูุฉ.");
    if (co === "ุชุตุจุบุงุช") bullets.push("ููุชุตุจุบุงุช: ููุชุงููู C ุตุจุงุญูุง + ูุงูู ุดูุณ ุซุงุจุชโฆ ุฏู ุฑูู 1 ูู ุงูุชุญุณู.");
    if (co === "ูุณุงู") bullets.push("ูููุณุงู: ููุงุณููุงููุฏ + ุชูุดูุฑ ุฎููู (BHA) ูุฑุฉ/ุฃุณุจูุน ุญุณุจ ุงูุชุญูู.");
    if (co === "ุฌูุงู") bullets.push("ููุฌูุงู: ููุงููุฑูููู ุนูู ุจุดุฑุฉ ูุจูููุฉ + ูุฑุทุจ ุชููู ุดููุฉโฆ ูุฎูู ุงูุบุณูู ูุทูู.");
    if (co === "ุญุณุงุณูุฉ") bullets.push("ูู ุชูููุฌ: ูููู ุงูููุดุฑุงุช/ุงูุฑูุชูููู ูุคูุชูุง ูุฑูุฒู ุนูู ุชุฑุทูุจ ูุทูู ุจุณ.");

    bullets.push("ูุงุนุฏุฉ ุฐูุจูุฉ: **SPF ูููููุง** ุญุชู ูู ูู ุงูุจูุชโฆ ุจููุฑู ุฌุฏูุง ูู ุฃู ูุดููุฉ.");

    const note = "ูู ุชูููุฌ ุดุฏูุฏ/ูุณุชูุฑ ุฃู ุญุจูุจ ูุคููุฉ: ุงูุฃูุถู ุฏูุชูุฑ ุฌูุฏูุฉ. ูุงุนููู Patch test ูุจู ุฃู ููุชุฌ ุฌุฏูุฏ.";
    const extraSteps =
      "\n\n**ุฎุทูุงุช ุณุฑูุนุฉ (ุณููุฉ):**\n" +
      "1) ุตุจุงุญูุง: ุบุณูู โ ุณูุฑู ุจุณูุท โ ูุฑุทุจ โ ูุงูู ุดูุณ SPF\n" +
      "2) ููููุง: ุบุณูู โ ุนูุงุฌ/ุณูุฑู ุญุณุจ ุงูุญุงูุฉ โ ูุฑุทุจ\n" +
      "\nููู ุชุญุจูโฆ ุงุจุนุชููู ููุน ุจุดุฑุชู ูุฃูุง ุฃุธุจุทูููู ุจุงูุชุฑุชูุจ ุงูุตุญ ๐";

    let title = "ุณููู ููุฑ";
    if (st) title += " โ " + st;
    if (co) title += " (" + co + ")";

    return wrap(title, bullets.slice(0, 7), "ููุน ุจุดุฑุชู ุฅููุ ูุฃูุชุฑ ูุดููุฉ ูุถุงููุงูู ุฅููุ", note) + extraSteps;
  }

  // ===== Routing =====
  try {
    if (hasAny(accKeys)) return send(200, { reply: accessoriesReply() });
    if (hasAny(makeupKeys)) return send(200, { reply: makeupReply() });
    if (hasAny(skincareKeys)) return send(200, { reply: skincareReply() });

    // ูู ูุด ูุงุถุญโฆ ูุฏู ูููู ูุทูู ุจุฏู ุฑุฏ ุจุงุฑุฏ
    return send(200, { reply: menuReply() });

  } catch {
    // ูุงููุนุด ุฃุจุฏุงู
    return send(200, { reply: "ุญุตูุช ูุฎุจุทุฉ ุจุณูุทุฉ ูุง ููุฑ ๐ ุงูุชุจู ุณุคุงูู ุชุงูู ูุงูุง ูุนุงูู." });
  }
}
